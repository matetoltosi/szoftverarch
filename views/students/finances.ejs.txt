<%- include('../partials/header') %>

<h1>Pénzügyek</h1>

<section>
    <h3 style="color: red;">Befizetésre váró tételek</h3>
    
    <table border="1" cellpadding="5">
        <thead>
            <tr>
                <th>Jogcím</th>
                <th>Határidő</th>
                <th>Összeg</th>
                <th>Státusz</th>
                <th>Művelet</th>
            </tr>
        </thead>
        <tbody>
            <% 
            const pendingFees = fees.filter(f => f.status === 'PENDING');
            if (pendingFees.length > 0) { 
                pendingFees.forEach(fee => { %>
                <tr>
                    <td><%= fee.title %></td>
                    <td><%= new Date(fee.dueDate).toLocaleDateString() %></td>
                    <td><strong><%= fee.amount %> <%= fee.currency %></strong></td>
                    <td>Függőben</td>
                    <td>
                        <form action="/api/v1/finances/pay" method="POST">
                            <input type="hidden" name="feeId" value="<%= fee._id %>">
                            <button type="submit">Befizetés indítása</button>
                        </form>
                    </td>
                </tr>
            <% }) 
            } else { %>
                <tr><td colspan="5">Nincs tartozásod.</td></tr>
            <% } %>
        </tbody>
    </table>
</section>

<br>

<section>
    <h3>Teljesített befizetések</h3>
    <table border="1" cellpadding="5" style="color: gray;">
        <thead>
            <tr>
                <th>Jogcím</th>
                <th>Befizetés dátuma</th>
                <th>Összeg</th>
                <th>Státusz</th>
            </tr>
        </thead>
        <tbody>
            <% 
            const paidFees = fees.filter(f => f.status === 'PAID');
            if (paidFees.length > 0) { 
                paidFees.forEach(fee => { %>
                <tr>
                    <td><%= fee.title %></td>
                    <td><%= new Date(fee.paymentDate).toLocaleDateString() %></td>
                    <td><%= fee.amount %> <%= fee.currency %></td>
                    <td style="color: green;">Teljesítve</td>
                </tr>
            <% }) 
            } else { %>
                <tr><td colspan="4">Nincs megjeleníthető előzmény.</td></tr>
            <% } %>
        </tbody>
    </table>
</section>

<%- include('../partials/footer') %>